---
// Client-side probe to track visitors
---

<script>
  // Generate or retrieve session ID
  function getSessionId(): string {
    let sessionId = localStorage.getItem('visitor_session_id');

    if (!sessionId) {
      // Generate a random session ID
      sessionId = `${Date.now()}-${Math.random().toString(36).substring(2, 15)}`;
      localStorage.setItem('visitor_session_id', sessionId);
    }

    return sessionId;
  }

  // Track visitor
  async function trackVisit() {
    try {
      const sessionId = getSessionId();

      await fetch('/api/track', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ sessionId }),
      });
    } catch (error) {
      // Silently fail - analytics shouldn't break the site
      console.debug('Analytics tracking failed:', error);
    }
  }

  // Track on page load
  trackVisit();

  // Track on View Transitions navigation (if enabled)
  document.addEventListener('astro:page-load', () => {
    trackVisit();
  });
</script>
