---
interface Props {
  path: string;
}

const { path } = Astro.props;
---

<span class="post-views" data-path={path}>
  <span class="view-count"></span>
</span>

<script>
  document.addEventListener('astro:page-load', () => {
    document.querySelectorAll('.post-views').forEach(async (el) => {
      const path = el.getAttribute('data-path');
      if (!path) return;

      try {
        const response = await fetch(`/api/analytics?path=${encodeURIComponent(path)}`);
        if (response.ok) {
          const data = await response.json();
          const countEl = el.querySelector('.view-count') as HTMLElement;
          if (countEl) {
            countEl.textContent = (data.allTime || 0) + ' views';
            countEl.classList.add('loaded');
          }
        }
      } catch (error) {
        // Silent fail
      }
    });
  });
</script>

<style>
  .post-views {
    font-size: 0.85rem;
    color: var(--text-secondary);
  }

  .view-count {
    font-family: var(--serif);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .view-count.loaded {
    opacity: 1;
  }
</style>
